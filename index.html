<!DOCTYPE html>
<html>
<head>
  <title>A1 Drycleaners</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
  body { margin: 0; font-family: "Segoe UI", Arial, sans-serif; background: linear-gradient(135deg, #e0f2fe, #f8fafc); min-height: 100vh; display: flex; justify-content: center; align-items: center; }
  .box { background: white; padding: 26px; border-radius: 16px; width: 92%; max-width: 380px; box-shadow: 0 15px 35px rgba(0,0,0,0.12); }
  h1 { text-align: center; margin-bottom: 22px; font-size: 24px; color: #1e293b; }
  input, select { width: 100%; padding: 14px; margin-bottom: 14px; font-size: 16px; border-radius: 10px; border: 1px solid #cbd5e1; outline: none; box-sizing: border-box;}
  input:focus, select:focus { border-color: #2563eb; }
  button { width: 100%; padding: 15px; font-size: 17px; border-radius: 12px; border: none; background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; cursor: pointer; margin-bottom: 12px; font-weight: 500; }
  button:active { transform: scale(0.98); }
  .back { background: linear-gradient(135deg, #64748b, #475569); }
  p { font-size: 15px; color: #334155; line-height: 1.5; }
  hr { border: none; border-top: 1px solid #e5e7eb; margin: 14px 0; }
  .bill-card { background: #f8fafc; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 8px; }
  .due { color: #dc2626; font-weight: bold; }
  .paid { color: #16a34a; font-weight: bold; }
  </style>
</head>
<body>

<div class="box" id="home">
  <h1>üß∫ A1 DRYCLEANERS<br>‡§è1 ‡§°‡•ç‡§∞‡§æ‡§Ø‡§ï‡•ç‡§≤‡§ø‡§®‡§∞‡•ç‡§∏</h1>
  <button onclick="showAdd()">‚ûï Add Customer</button>
  <button onclick="showBill()">üßæ New Bill</button>
  <button onclick="showList()">üìã View History</button>
</div>

<div class="box" id="add" style="display:none">
  <h1>Add Customer</h1>
  <input id="nameMarathi" placeholder="‡§®‡§æ‡§µ (Marathi)">
  <input id="nameEnglish" placeholder="Name (English)">
  <input id="mobile" type="number" placeholder="Mobile Number">
  <button onclick="saveCustomer()">Save Customer</button>
  <button class="back" onclick="goHome()">‚¨Ö Back</button>
</div>

<div class="box" id="bill" style="display:none">
  <h1>New Bill</h1>
  <select id="billCustomer"></select>
  <input id="total" type="number" placeholder="Total Amount">
  <input id="paid" type="number" placeholder="Paid Amount">
  <button onclick="saveBill()">Save & Send WhatsApp</button>
  <button class="back" onclick="goHome()">‚¨Ö Back</button>
</div>

<div class="box" id="list" style="display:none">
  <h1>History</h1>
  <div style="text-align:center; margin-bottom:10px;">
    <button style="padding:8px; width:auto; font-size:14px;" onclick="loadCustomers()">Show Customers</button>
    <button style="padding:8px; width:auto; font-size:14px;" onclick="loadBills()">Show Bills</button>
  </div>
  <div id="listContent"></div>
  <button class="back" onclick="goHome()">‚¨Ö Back</button>
</div>

<script>
// --- NAVIGATION ---
function showAdd() { hideAll(); add.style.display = "block"; }
function showBill() { hideAll(); bill.style.display = "block"; loadCustomerOptions(); }
function showList() { hideAll(); list.style.display = "block"; loadBills(); }
function goHome() { hideAll(); home.style.display = "block"; }
function hideAll() { home.style.display = add.style.display = bill.style.display = list.style.display = "none"; }

// --- CUSTOMERS ---
function saveCustomer() {
  const customer = { marathi: nameMarathi.value, english: nameEnglish.value, mobile: mobile.value };
  if (!customer.english || !customer.mobile) return alert("Fill English Name & Mobile");

  // Fetch to RELATIVE path (works on cloud automatically)
  fetch("/customers", {
    method: "POST", headers: { "Content-Type": "application/json" },
    body: JSON.stringify(customer)
  })
  .then(res => res.json())
  .then(() => {
    alert("Customer Saved ‚úÖ");
    nameMarathi.value = ""; nameEnglish.value = ""; mobile.value = "";
    goHome();
  });
}

function loadCustomerOptions() {
  billCustomer.innerHTML = "<option>Loading...</option>";
  fetch("/customers")
    .then(res => res.json())
    .then(data => {
      billCustomer.innerHTML = "<option value=''>Select Customer</option>";
      data.forEach(c => {
        // Store whole object in value for easy access
        billCustomer.innerHTML += `<option value='${JSON.stringify(c)}'>${c.english}</option>`;
      });
    });
}

// --- BILLS ---
function saveBill() {
  if(!billCustomer.value) return alert("Select a customer");
  const c = JSON.parse(billCustomer.value);
  const totalAmt = Number(total.value);
  const paidAmt = Number(paid.value);
  
  if(!totalAmt) return alert("Enter Amount");

  const due = totalAmt - paidAmt;
  const now = new Date().toLocaleString();

  const billData = {
    customerName: c.english,
    customerMobile: c.mobile,
    total: totalAmt,
    paid: paidAmt,
    due: due,
    date: now
  };

  fetch("/bills", {
    method: "POST", headers: { "Content-Type": "application/json" },
    body: JSON.stringify(billData)
  })
  .then(res => res.json())
  .then(() => {
    // WhatsApp Logic
    const msg = `‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞ ${c.english},\n‡§§‡•Å‡§Æ‡§ö‡•á ‡§ï‡§™‡§°‡•á ‡§§‡§Ø‡§æ‡§∞ ‡§Ü‡§π‡•á‡§§ üôèüòä\n‡§è‡§ï‡•Ç‡§£ ‡§¨‡§ø‡§≤: ‚Çπ${totalAmt}\n‡§ú‡§Æ‡§æ: ‚Çπ${paidAmt}\n‡§¨‡§æ‡§ï‡•Ä: ‚Çπ${due}\n\n‚Äì A-1 DRYCLEANERS`;
    const whatsappURL = "https://wa.me/91" + c.mobile + "?text=" + encodeURIComponent(msg);
    
    // Clear inputs and redirect
    total.value = ""; paid.value = "";
    window.location.href = whatsappURL; 
  });
}

// --- DISPLAY LISTS ---
function loadCustomers() {
  listContent.innerHTML = "Loading...";
  fetch("/customers").then(res => res.json()).then(data => {
    listContent.innerHTML = "";
    data.forEach(c => {
      listContent.innerHTML += `<p><b>${c.marathi}</b><br>${c.english}<br>üìû ${c.mobile}</p><hr>`;
    });
  });
}

function loadBills() {
  listContent.innerHTML = "Loading...";
  fetch("/bills").then(res => res.json()).then(data => {
    listContent.innerHTML = "";
    data.forEach(b => {
      listContent.innerHTML += `
        <div class="bill-card">
          <b>${b.customerName}</b><br>
          Total: ‚Çπ${b.total} | Paid: ‚Çπ${b.paid}<br>
          <span class="${b.due > 0 ? 'due' : 'paid'}">Due: ‚Çπ${b.due}</span><br>
          <small style="color:#666">${b.date}</small>
        </div>`;
    });
  });
}
</script>
</body>
</html>